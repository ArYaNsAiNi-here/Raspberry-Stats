<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Raspberry Pi System Monitor</title>
</head>
<body>
  <div class="container">
    <h1>Raspberry Pi Stats</h1>
    <div class="stat">CPU Temperature: <span id="cpu_temp" class="value">Loading...</span> Â°C</div>
    <div class="stat">CPU Usage: <span id="cpu_usage" class="value">Loading...</span> %</div>
    <div class="stat">RAM Usage: <span id="ram_usage" class="value">Loading...</span> %</div>
    <div class="stat">Disk Usage: <span id="disk_usage" class="value">Loading...</span> %</div>
    <div class="stat">Last Updated: <span id="last_updated" class="value">Loading...</span></div>
  </div>

  <script>
    // Function to animate updates by adding the "updated" class temporarily
    function animateUpdate(element) {
      element.classList.add("updated");
      setTimeout(() => {
        element.classList.remove("updated");
      }, 500); // Animation lasts 500ms
    }

    async function fetchStats() {
      try {
        const response = await fetch('/api/stats/');
        const data = await response.json();

        // For each stat element, update the text content and trigger the update animation if needed.
        const cpuTempElem = document.getElementById('cpu_temp');
        if (cpuTempElem.textContent !== data.cpu_temp) {
          cpuTempElem.textContent = data.cpu_temp;
          animateUpdate(cpuTempElem);
        }

        const cpuUsageElem = document.getElementById('cpu_usage');
        if (cpuUsageElem.textContent !== data.cpu_usage) {
          cpuUsageElem.textContent = data.cpu_usage;
          animateUpdate(cpuUsageElem);
        }

        const ramUsageElem = document.getElementById('ram_usage');
        if (ramUsageElem.textContent !== data.ram_usage) {
          ramUsageElem.textContent = data.ram_usage;
          animateUpdate(ramUsageElem);
        }

        const diskUsageElem = document.getElementById('disk_usage');
        if (diskUsageElem.textContent !== data.disk_usage) {
          diskUsageElem.textContent = data.disk_usage;
          animateUpdate(diskUsageElem);
        }

        const lastUpdatedElem = document.getElementById('last_updated');
        if (lastUpdatedElem.textContent !== data.last_updated) {
          lastUpdatedElem.textContent = data.last_updated;
          animateUpdate(lastUpdatedElem);
        }
      } catch (error) {
        console.error('Error fetching system stats:', error);
      }
    }

    // Initial fetch then update every 5 seconds.
    fetchStats();
    setInterval(fetchStats, 10000);
  </script>
</body>
</html>